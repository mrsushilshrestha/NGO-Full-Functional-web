{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}Our Team{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700;800&family=Inter:wght@400;600;800&family=Lato:wght@400;700&family=Merriweather:wght@400;700&family=Nunito:wght@400;600;700;800&family=Open+Sans:wght@400;600;700&family=Playfair+Display:wght@400;600;700&family=Poppins:wght@400;600;700;800&family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{
    --team-title-size: {{ team_settings.title_font_size_px }}px;
    --team-subtitle-size: {{ team_settings.subtitle_font_size_px }}px;
    --team-card-radius: {{ team_settings.card_radius_px }}px;
    --team-card-min-h: {{ team_settings.card_min_height_px }}px;
    --team-card-max-h: {{ team_settings.card_max_height_px }}px;
    --team-card-padding: {{ team_settings.card_padding_px }}px;
    --team-section-spacing: {{ team_settings.section_spacing_px }}px;
    --team-social-size: {{ team_settings.social_icon_size_px }}px;
    --team-name-size: {{ team_settings.name_font_size_px }}px;
    --team-role-size: {{ team_settings.role_font_size_px }}px;
    --team-id-size: {{ team_settings.id_font_size_px }}px;
}

.team-hero-title {
    font-family: {% if team_settings.title_font_family == 'nunito' %}'Nunito'{% elif team_settings.title_font_family == 'plus_jakarta' %}'Plus Jakarta Sans'{% elif team_settings.title_font_family == 'inter' %}'Inter'{% elif team_settings.title_font_family == 'poppins' %}'Poppins'{% elif team_settings.title_font_family == 'open_sans' %}'Open Sans'{% elif team_settings.title_font_family == 'lato' %}'Lato'{% elif team_settings.title_font_family == 'roboto' %}'Roboto'{% elif team_settings.title_font_family == 'playfair' %}'Playfair Display'{% elif team_settings.title_font_family == 'merriweather' %}'Merriweather'{% else %}'DM Sans'{% endif %}, system-ui, sans-serif;
    font-weight: 800;
    font-size: var(--team-title-size);
    color: {{ team_settings.title_color }};
    letter-spacing: -0.02em;
    line-height: 1.2;
    min-height: 1.3em;
    text-align: {{ team_settings.heading_align }};
}
.team-hero-subtitle {
    font-family: {% if team_settings.subtitle_font_family == 'nunito' %}'Nunito'{% elif team_settings.subtitle_font_family == 'plus_jakarta' %}'Plus Jakarta Sans'{% elif team_settings.subtitle_font_family == 'inter' %}'Inter'{% elif team_settings.subtitle_font_family == 'poppins' %}'Poppins'{% elif team_settings.subtitle_font_family == 'open_sans' %}'Open Sans'{% elif team_settings.subtitle_font_family == 'lato' %}'Lato'{% elif team_settings.subtitle_font_family == 'roboto' %}'Roboto'{% elif team_settings.subtitle_font_family == 'playfair' %}'Playfair Display'{% elif team_settings.subtitle_font_family == 'merriweather' %}'Merriweather'{% else %}'DM Sans'{% endif %}, system-ui, sans-serif;
    font-weight: 400;
    font-size: var(--team-subtitle-size);
    color: {{ team_settings.subtitle_color }};
    line-height: 1.65;
    min-height: 3em;
    text-align: {{ team_settings.heading_align }};
}
.team-hero-title.team-anim-fade { animation: team-title-fade 0.7s ease-out; }
.team-hero-title.team-anim-slide { animation: team-title-slide 0.7s ease-out; }
.team-hero-title.team-anim-zoom { animation: team-title-zoom 0.5s ease-out; }
.team-hero-title.team-anim-bounce { animation: team-title-bounce 0.7s ease; }
@keyframes team-title-fade { from { opacity: 0; } to { opacity: 1; } }
@keyframes team-title-slide { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
@keyframes team-title-zoom { from { opacity: 0; transform: scale(0.92); } to { opacity: 1; transform: scale(1); } }
@keyframes team-title-bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
.typed-cursor {
    display: inline-block;
    width: 3px;
    height: 1em;
    background: var(--primary);
    margin-left: 2px;
    vertical-align: -0.15em;
    animation: team-blink 0.8s step-end infinite;
}
@keyframes team-blink {
    50% { opacity: 0; }
}
/* Full-width decorative line under category (Board Members / Volunteers) */
.team-category-line {
    margin: 0 0 1.5rem 0;
    border: none;
    border-radius: 999px;
}

/* Watermark background on Team page */
.team-page-wrap { position: relative; }
/* Dark theme for Team page */
.team-page-dark .team-hero-title,
.team-page-dark .team-hero-subtitle { color: #e2e8f0 !important; }
.team-page-dark .section-title,
.team-page-dark .section-subtitle,
.team-page-dark .h4,
.team-page-dark .form-label,
.team-page-dark .text-muted { color: #94a3b8 !important; }
.team-page-dark .team-filters .form-control,
.team-page-dark .team-filters .form-select { background: #334155; border-color: #475569; color: #f1f5f9; }
.team-page-dark .btn-outline-primary { border-color: #64748b; color: #e2e8f0; }
.team-page-dark .btn-outline-primary:hover { background: #475569; border-color: #64748b; color: #fff; }
.team-page-dark .btn-primary { background: #0d9488; border-color: #0d9488; }

.team-watermark {
    position: absolute;
    inset: 0;
    pointer-events: none;
    background-repeat: no-repeat;
    background-position:
        {% if team_settings.watermark_position == 'top-left' %}left top
        {% elif team_settings.watermark_position == 'top-right' %}right top
        {% elif team_settings.watermark_position == 'bottom-left' %}left bottom
        {% elif team_settings.watermark_position == 'bottom-right' %}right bottom
        {% else %}center{% endif %};
    background-size: {{ team_settings.watermark_size_percent }}%;
    opacity: {{ team_settings.watermark_opacity }};
    filter: grayscale(1);
}

/* Team section – card styling from CMS */
.member-card-modern {
    position: relative;
    border-radius: var(--team-card-radius);
    overflow: hidden;
    min-height: var(--team-card-min-h);
    aspect-ratio: 4 / 5;
    max-height: var(--team-card-max-h);
    box-sizing: border-box;
    transition: transform 0.35s ease-in-out, box-shadow 0.35s ease-in-out, box-shadow 0.35s;
    cursor: pointer;
    background: #0a0a0a;
}
/* Card shadow: none / soft / medium / strong */
.team-cards-shadow-none .member-card-modern { box-shadow: none; }
.team-cards-shadow-soft .member-card-modern { box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06); }
.team-cards-shadow-medium .member-card-modern,
.member-card-modern { box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08), 0 2px 10px rgba(0, 0, 0, 0.04); }
.team-cards-shadow-strong .member-card-modern { box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12), 0 4px 16px rgba(0, 0, 0, 0.08); }
.team-cards-hover-lift .member-card-modern:hover,
.member-card-modern:hover { transform: translateY(-8px); box-shadow: 0 18px 48px rgba(0, 0, 0, 0.12), 0 8px 20px rgba(0, 0, 0, 0.06); }
.team-cards-hover-scale .member-card-modern:hover { transform: scale(1.03); box-shadow: 0 18px 48px rgba(0, 0, 0, 0.12); }
.team-cards-hover-glow .member-card-modern:hover { box-shadow: 0 0 32px rgba(11, 83, 69, 0.35), 0 12px 40px rgba(0, 0, 0, 0.1); }
.team-cards-hover-none .member-card-modern:hover { transform: none; box-shadow: inherit; }
/* Card enter animation */
.team-card-anim-fadeIn .member-card-modern { animation: team-card-fadeIn 0.5s ease-out; }
.team-card-anim-slideUp .member-card-modern { animation: team-card-slideUp 0.5s ease-out; }
.team-card-anim-zoomIn .member-card-modern { animation: team-card-zoomIn 0.4s ease-out; }
@keyframes team-card-fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes team-card-slideUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
@keyframes team-card-zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
.member-card-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease-in-out;
    z-index: 1;
}
.member-card-modern:hover .member-card-image {
    transform: scale(1.06);
}
/* Soft gradient at bottom for readability */
.member-card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to top, rgba(0,0,0,0.88) 0%, rgba(0,0,0,0.5) 40%, rgba(0,0,0,0.2) 65%, transparent 100%);
    z-index: 2;
    pointer-events: none;
}
/* Content block – name, role, ID and social at bottom, aligned together */
.member-card-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 3;
    padding: 20px var(--team-card-padding) 6px var(--team-card-padding);
    margin-bottom: 0;
    min-height: 185px;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    color: #ffffff !important;
}
.member-card-name {
    font-size: var(--team-name-size);
    font-weight: 700;
    line-height: 1.3;
    margin: 0 0 8px 0;
    text-shadow: 0 2px 12px rgba(0,0,0,0.5);
    color: #ffffff !important;
}
.member-card-role {
    font-size: var(--team-role-size);
    font-weight: 400;
    margin: 0 0 12px 0;
    opacity: 0.92;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: #ffffff !important;
}
.member-card-id-wrap {
    margin-bottom: 8px;
}
.member-card-id {
    font-size: var(--team-id-size);
    font-weight: 600;
    background: rgba(255, 255, 255, 0.18);
    color: #ffffff !important;
    padding: 6px 13px;
    border-radius: 20px;
    display: inline-block;
    border: 1px solid rgba(255, 255, 255, 0.24);
}
/* Social icons – aligned with text above, slightly lower for spacing */
.member-card-social {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 6px;
    margin-bottom: 0;
    padding-bottom: 2px;
    margin-left: auto;
    justify-content: flex-end;
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
}
.member-card-modern:hover .member-card-social {
    opacity: 1;
    transform: translateY(0);
}
.member-social-icon {
    width: var(--team-social-size);
    height: var(--team-social-size);
    min-width: var(--team-social-size);
    min-height: var(--team-social-size);
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.14);
    border-radius: 50%;
    color: #ffffff !important;
    text-decoration: none;
    border: 1px solid rgba(255, 255, 255, 0.2);
    transition: transform 0.25s ease-in-out, background-color 0.25s ease-in-out, box-shadow 0.25s ease-in-out;
    box-shadow: 0 2px 8px rgba(0,0,0,0.12);
}
.member-social-icon:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-3px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.2);
    color: #ffffff !important;
}
.member-social-icon i {
    font-size: 0.8rem;
}
.member-card-placeholder {
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3.5rem;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.9);
    text-transform: uppercase;
}
.team-filters .form-control,
.team-filters .form-select { border-radius: 10px; transition: box-shadow 0.2s ease, border-color 0.2s ease; }
.team-filters .form-control:focus,
.team-filters .form-select:focus { box-shadow: 0 0 0 3px rgba(11, 83, 69, 0.15); }
.team-filters .btn { border-radius: 10px; font-weight: 600; }
@media (max-width: 992px) {
    .team-hero-title { font-size: calc(var(--team-title-size) * 0.85); }
    .team-hero-subtitle { font-size: calc(var(--team-subtitle-size) * 0.92); }
    .member-card-modern { min-height: calc(var(--team-card-min-h) * 0.95); max-height: calc(var(--team-card-max-h) * 0.95); }
    .member-card-content { min-height: 172px; padding: 18px 20px 4px 20px; margin-bottom: 0; }
}
@media (max-width: 768px) {
    .member-card-modern {
        min-height: calc(var(--team-card-min-h) * 0.9);
        max-height: calc(var(--team-card-max-h) * 0.9);
        border-radius: 16px;
    }
    .member-card-content {
        min-height: 168px;
        padding: 18px 20px 4px 20px;
        margin-bottom: 0;
    }
    .member-card-name { font-size: calc(var(--team-name-size) * 0.9); }
    .member-card-role { font-size: calc(var(--team-role-size) * 0.92); }
    .member-card-social { opacity: 1; transform: translateY(0); }
    .member-card-placeholder { font-size: 3rem; }
}
</style>
{% endblock %}

{% block content %}
<section class="py-5 team-page-section team-page-{{ team_settings.theme_mode|default:'light' }} team-cards-shadow-{{ team_settings.card_shadow|default:'medium' }} team-cards-hover-{{ team_settings.card_hover_effect|default:'lift' }} team-card-anim-{{ team_settings.card_animation|default:'none' }}" style="background: {% if team_settings.theme_mode == 'dark' %}#1e293b{% else %}var(--bg-warm){% endif %};" data-title-animation="{{ team_settings.title_animation|default:'typing' }}" data-typing-enabled="{{ team_settings.typing_enabled|yesno:'1,0' }}" data-typing-speed="{{ team_settings.typing_speed_ms }}">
    <div class="container team-page-wrap">
        {% if team_settings.background_watermark %}
        <div class="team-watermark" style="background-image: url('{{ team_settings.background_watermark.url }}');" aria-hidden="true"></div>
        {% endif %}

        <h1 class="team-hero-title mb-2 team-anim-{{ team_settings.title_animation|default:'typing' }}" id="team-title" data-title="{{ team_settings.title_text|escape }}" aria-live="polite"></h1>
        <p class="team-hero-subtitle mb-4" id="team-subtitle-wrap"
           data-count="{{ member_count }}"
           data-subtitle-template="{{ team_settings.subtitle_template|escape }}"
           data-title-animation="{{ team_settings.title_animation|default:'typing' }}"
           data-typing-enabled="{{ team_settings.typing_enabled|yesno:'1,0' }}"
           data-typing-speed="{{ team_settings.typing_speed_ms }}"
           aria-live="polite">
            <span id="team-subtitle"></span><span class="typed-cursor" id="team-cursor" aria-hidden="true"></span>
        </p>

        <!-- Search, Filters, and Join Us navigation -->
        <form method="get" class="row g-3 mb-4 align-items-end team-filters">
            {% if team_settings.show_search %}
            <div class="col-md-4 col-lg-3">
                <label for="search-input" class="form-label small text-muted mb-1">Search Members</label>
                <input type="text" name="search" id="search-input" class="form-control rounded-3" placeholder="Name, role, ID..." value="{{ search }}">
            </div>
            {% endif %}
            <div class="col-md-3 col-lg-2">
                <label for="chapter-select" class="form-label small text-muted mb-1">Chapter</label>
                <select name="chapter" id="chapter-select" class="form-select">
                    <option value="">All Chapters</option>
                    {% for ch in chapters %}
                    <option value="{{ ch.id }}" {% if chapter_filter == ch.id|stringformat:"d" %}selected{% endif %}>{{ ch.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-2 col-lg-2">
                <label class="form-label small text-muted mb-1 d-block">View</label>
                <div class="btn-group" role="group" aria-label="View mode">
                    <a href="?{% for k,v in request.GET.items %}{% if k != 'view' %}{{ k }}={{ v }}&{% endif %}{% endfor %}view=grid" class="btn btn-outline-primary {% if view_mode == 'grid' %}active{% endif %}">
                        <i class="fas fa-th-large"></i>
                    </a>
                    <a href="?{% for k,v in request.GET.items %}{% if k != 'view' %}{{ k }}={{ v }}&{% endif %}{% endfor %}view=list" class="btn btn-outline-primary {% if view_mode == 'list' %}active{% endif %}">
                        <i class="fas fa-list"></i>
                    </a>
                </div>
            </div>
            <div class="col-md-3 col-lg-5 text-md-end">
                {% if search or chapter_filter %}
                <a href="{% url 'team_list' %}" class="btn btn-outline-secondary me-2" title="Clear search and filters">
                    <i class="fas fa-times me-1"></i>Clear
                </a>
                {% endif %}
                {% if team_settings.show_search %}
                <button type="submit" class="btn btn-outline-primary me-2">
                    <i class="fas fa-search me-1"></i>Search
                </button>
                {% endif %}
                <a href="#join" class="btn btn-primary">
                    <i class="fas fa-user-plus me-1"></i>Join Us
                </a>
            </div>
        </form>

        <!-- Board Members – three cards per row -->
        {% if board_members %}
        <div class="mb-5" style="margin-bottom: var(--team-section-spacing);">
            <h2 class="h4 mb-2">Board Members</h2>
            <hr class="team-category-line" style="
                {% if team_settings.board_line_style == 'gradient' %}
                    height: {{ team_settings.board_line_thickness_px }}px;
                    background: linear-gradient(90deg, transparent 0%, {{ team_settings.board_line_color }} 18%, {{ team_settings.board_line_color_2 }} 50%, {{ team_settings.board_line_color }} 82%, transparent 100%);
                {% else %}
                    height: 0;
                    background: transparent;
                    border-top: {{ team_settings.board_line_thickness_px }}px {{ team_settings.board_line_style }} {{ team_settings.board_line_color }};
                {% endif %}
                width: {% if team_settings.board_line_full_width %}100%{% else %}{{ team_settings.board_line_length_percent }}%{% endif %};
                margin-left: {% if team_settings.board_line_full_width %}0{% else %}auto{% endif %};
                margin-right: {% if team_settings.board_line_full_width %}0{% else %}auto{% endif %};
            ">
            <div class="row g-4">
                {% for member in board_members %}
                <div class="col-12 col-md-4">
                    <a href="{% url 'member_detail' member.pk %}" class="text-decoration-none">
                        <div class="member-card-modern">
                            {% if member.photo %}
                            <img src="{{ member.photo.url }}" alt="{{ member.name }}" class="member-card-image">
                            {% else %}
                            <div class="member-card-placeholder">{{ member.initials }}</div>
                            {% endif %}
                            <div class="member-card-overlay"></div>
                            <div class="member-card-content">
                                <div class="member-card-name">{{ member.name }}</div>
                                <div class="member-card-role">
                                    {% if member.role %}Board Member · {{ member.role }}{% else %}Board Member{% endif %}
                                </div>
                                {% if member.member_id %}
                                <div class="member-card-id-wrap"><span class="member-card-id">{{ member.member_id }}</span></div>
                                {% endif %}
                                <div class="member-card-social">
                                {% if member.facebook_url %}
                                <a href="{{ member.facebook_url }}" target="_blank" rel="noopener" class="member-social-icon" title="Facebook">
                                    <i class="fab fa-facebook-f"></i>
                                </a>
                                {% endif %}
                                {% if member.instagram_url %}
                                <a href="{{ member.instagram_url }}" target="_blank" rel="noopener" class="member-social-icon" title="Instagram">
                                    <i class="fab fa-instagram"></i>
                                </a>
                                {% endif %}
                                {% if member.linkedin_url %}
                                <a href="{{ member.linkedin_url }}" target="_blank" rel="noopener" class="member-social-icon" title="LinkedIn">
                                    <i class="fab fa-linkedin-in"></i>
                                </a>
                                {% endif %}
                                {% if member.email %}
                                <a href="mailto:{{ member.email }}" class="member-social-icon" title="Email">
                                    <i class="fas fa-envelope"></i>
                                </a>
                                {% endif %}
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Volunteers – three cards per row -->
        <div class="{% if board_members %}mt-5{% endif %}" style="margin-top: var(--team-section-spacing);">
            <h2 class="h4 mb-2">Volunteers</h2>
            <hr class="team-category-line" style="
                {% if team_settings.volunteer_line_style == 'gradient' %}
                    height: {{ team_settings.volunteer_line_thickness_px }}px;
                    background: linear-gradient(90deg, transparent 0%, {{ team_settings.volunteer_line_color }} 18%, {{ team_settings.volunteer_line_color_2 }} 50%, {{ team_settings.volunteer_line_color }} 82%, transparent 100%);
                {% else %}
                    height: 0;
                    background: transparent;
                    border-top: {{ team_settings.volunteer_line_thickness_px }}px {{ team_settings.volunteer_line_style }} {{ team_settings.volunteer_line_color }};
                {% endif %}
                width: {% if team_settings.volunteer_line_full_width %}100%{% else %}{{ team_settings.volunteer_line_length_percent }}%{% endif %};
                margin-left: {% if team_settings.volunteer_line_full_width %}0{% else %}auto{% endif %};
                margin-right: {% if team_settings.volunteer_line_full_width %}0{% else %}auto{% endif %};
            ">
            <div class="row g-4">
                {% for member in volunteer_page_obj %}
                <div class="col-12 col-md-4">
                    <a href="{% url 'member_detail' member.pk %}" class="text-decoration-none">
                        <div class="member-card-modern">
                            {% if member.photo %}
                            <img src="{{ member.photo.url }}" alt="{{ member.name }}" class="member-card-image">
                            {% else %}
                            <div class="member-card-placeholder">{{ member.initials }}</div>
                            {% endif %}
                            <div class="member-card-overlay"></div>
                            <div class="member-card-content">
                                <div class="member-card-name">{{ member.name }}</div>
                                <div class="member-card-role">
                                    {% if member.role %}Volunteer{% if member.role != 'Volunteer' %} · {{ member.role }}{% endif %}{% else %}Volunteer{% endif %}
                                </div>
                                {% if member.member_id %}
                                <div class="member-card-id-wrap"><span class="member-card-id">{{ member.member_id }}</span></div>
                                {% endif %}
                                <div class="member-card-social">
                                    {% if member.facebook_url %}
                                <a href="{{ member.facebook_url }}" target="_blank" rel="noopener" class="member-social-icon" title="Facebook">
                                    <i class="fab fa-facebook-f"></i>
                                </a>
                                {% endif %}
                                {% if member.instagram_url %}
                                <a href="{{ member.instagram_url }}" target="_blank" rel="noopener" class="member-social-icon" title="Instagram">
                                    <i class="fab fa-instagram"></i>
                                </a>
                                {% endif %}
                                {% if member.linkedin_url %}
                                <a href="{{ member.linkedin_url }}" target="_blank" rel="noopener" class="member-social-icon" title="LinkedIn">
                                    <i class="fab fa-linkedin-in"></i>
                                </a>
                                {% endif %}
                                {% if member.email %}
                                <a href="mailto:{{ member.email }}" class="member-social-icon" title="Email">
                                    <i class="fas fa-envelope"></i>
                                </a>
                                {% endif %}
                                </div>
                            </div>
                        </div>
                    </a>
                </div>
                {% empty %}
                <div class="col-12 text-center text-muted py-5">
                    <i class="fas fa-users fa-3x mb-3 opacity-50"></i>
                    <p>No volunteers found.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        {% if volunteer_page_obj.paginator.num_pages > 1 %}
        <nav aria-label="Volunteers pagination" class="mt-4">
            <ul class="pagination justify-content-center">
                {% if volunteer_page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?{% for k,v in request.GET.items %}{% if k != 'page' %}{{ k }}={{ v|urlencode }}&{% endif %}{% endfor %}page={{ volunteer_page_obj.previous_page_number }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link" aria-hidden="true">&laquo;</span>
                </li>
                {% endif %}

                {% for p in volunteer_pagination_range %}
                    {% if p %}
                        <li class="page-item {% if p == volunteer_page_obj.number %}active{% endif %}">
                            <a class="page-link" href="?{% for k,v in request.GET.items %}{% if k != 'page' %}{{ k }}={{ v|urlencode }}&{% endif %}{% endfor %}page={{ p }}">{{ p }}</a>
                        </li>
                    {% else %}
                        <li class="page-item disabled"><span class="page-link">…</span></li>
                    {% endif %}
                {% endfor %}

                {% if volunteer_page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?{% for k,v in request.GET.items %}{% if k != 'page' %}{{ k }}={{ v|urlencode }}&{% endif %}{% endfor %}page={{ volunteer_page_obj.next_page_number }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link" aria-hidden="true">&raquo;</span>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

        <hr class="my-5" id="join">
        <!-- Join Us Section with Volunteer / Member toggle -->
        <div class="row mt-5 pt-5">
            <div class="col-lg-10 mx-auto">
                <div class="p-4 p-md-5 rounded-4" style="background: linear-gradient(135deg, rgba(11,83,69,0.08), rgba(193,127,89,0.08));">
                    <div class="mb-4">
                        <h2 class="section-title mb-1">Join Us</h2>
                        <p class="section-subtitle mb-0">Apply as a volunteer to support our mission.</p>
                    </div>

                    <div class="row g-4">
                        <div class="col-lg-6">
                            <div id="join-volunteer" class="join-panel">
                                <h5 class="mb-3">Volunteer Application</h5>
                                <p class="text-muted small mb-3">Share your time and skills. Profile image max 200 KB.</p>
                                <form method="post" action="{% url 'volunteer_form' %}" enctype="multipart/form-data" class="bg-white rounded-3 p-3 p-md-4 shadow-sm">
                                    {% csrf_token %}
                                    {{ volunteer_join_form|crispy }}
                                    <div class="d-flex justify-content-between align-items-center mt-3">
                                        <button type="submit" class="btn btn-primary">Submit Volunteer Application</button>
                                        <small class="text-muted d-none d-md-inline">You’ll be redirected after submitting.</small>
                                    </div>
                                </form>
                            </div>

                        </div>
                        <div class="col-lg-6 d-none d-lg-block">
                            <div class="h-100 d-flex align-items-center">
                                <div class="w-100 ps-lg-4">
                                    <div class="stat-card alt mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h4 class="mb-1">Make an impact</h4>
                                                <p class="mb-0 small">Your time and membership help us reach more communities with health programs, education, and support.</p>
                                            </div>
                                            <i class="fas fa-hand-holding-heart fa-2x stat-icon"></i>
                                        </div>
                                    </div>
                                    <ul class="list-unstyled small mb-0">
                                        <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Transparent, CMS-managed membership fees</li>
                                        <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Secure payment via eSewa, Khalti, or Bank</li>
                                        <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Volunteer opportunities tailored to your skills</li>
                                        <li><i class="fas fa-check-circle text-success me-2"></i>Responsive design that works on any device</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% block extra_js %}
{{ block.super }}
<script>
(function() {
    // Typing animation – heading and subtitle (slow, friendly)
    var titleEl = document.getElementById('team-title');
    var subtitleEl = document.getElementById('team-subtitle');
    var cursorEl = document.getElementById('team-cursor');
    var wrapEl = document.getElementById('team-subtitle-wrap');
    if (titleEl && subtitleEl && cursorEl && wrapEl) {
        var count = wrapEl.getAttribute('data-count') || '0';
        var titleText = titleEl.getAttribute('data-title') || 'Our Team';
        var subtitleTemplate = wrapEl.getAttribute('data-subtitle-template') || '';
        var titleAnimation = wrapEl.getAttribute('data-title-animation') || 'typing';
        var typingEnabled = (wrapEl.getAttribute('data-typing-enabled') || '1') === '1';
        var speed = parseInt(wrapEl.getAttribute('data-typing-speed') || '90', 10);
        if (!speed || speed < 20) speed = 90;
        var pauseBetween = 500;
        var subtitleFull = (subtitleTemplate || '').replace('{count}', count);

        function boldFirstCount(text, countStr) {
            var idx = text.indexOf(countStr);
            if (idx === -1) return text;
            return text.slice(0, idx) + '<strong>' + countStr + '</strong>' + text.slice(idx + countStr.length);
        }

        var typingRunId = 0;
        function typeChar(runId, el, text, i, cb) {
            if (runId !== typingRunId) return;
            if (i >= text.length) {
                if (cb) setTimeout(function() { if (runId === typingRunId) cb(); }, pauseBetween);
                return;
            }
            el.textContent = text.slice(0, i + 1);
            setTimeout(function() { typeChar(runId, el, text, i + 1, cb); }, speed);
        }

        function runSequence() {
            typingRunId += 1;
            var runId = typingRunId;
            titleEl.textContent = '';
            subtitleEl.textContent = '';
            var useTyping = (titleAnimation === 'typing' && typingEnabled);
            if (!useTyping) {
                cursorEl.style.display = 'none';
                titleEl.textContent = titleText;
                subtitleEl.innerHTML = boldFirstCount(subtitleFull, count);
                return;
            }
            cursorEl.style.display = 'inline-block';
            typeChar(runId, titleEl, titleText, 0, function() {
                if (runId !== typingRunId) return;
                typeChar(runId, subtitleEl, subtitleFull, 0, function() {
                    if (runId !== typingRunId) return;
                    subtitleEl.innerHTML = boldFirstCount(subtitleFull, count);
                    cursorEl.style.display = 'none';
                });
            });
        }
        runSequence();
    }

    // Auto-submit on chapter dropdown change
    var chapterSelect = document.getElementById('chapter-select');
    const filterForm = document.querySelector('form[method="get"]');
    if (chapterSelect && filterForm) {
        chapterSelect.addEventListener('change', function() {
            filterForm.submit();
        });
    }
})();
</script>
{% endblock %}
{% endblock %}
