{% extends 'cms/base.html' %}
{% load static crispy_forms_tags %}
{% block title %}{{ title }}{% endblock %}
{% block page_title %}{{ title }}{% endblock %}
{% block extra_css %}
<style>
.banner-preview-wrap { aspect-ratio: 16/9; max-width: 640px; background: #111; border-radius: 8px; overflow: hidden; position: relative; }
.banner-preview-wrap img { width: 100%; height: 100%; object-fit: cover; }
.banner-preview-wrap .overlay { position: absolute; inset: 0; background: rgba(11,83,69, 0.7); display: flex; align-items: center; justify-content: center; }
.banner-preview-wrap .overlay .label-preview { color: white; text-align: center; padding: 1rem; }
.transparency-slider { max-width: 300px; }
</style>
{% endblock %}
{% block content %}
<div class="cms-card">
    <form method="post" enctype="multipart/form-data" id="bannerForm">
        {% csrf_token %}
        {{ form|crispy }}

        {% if form.instance.image %}
        <div class="mt-4 p-3 border rounded bg-light">
            <h6 class="mb-3">Image transparency / overlay</h6>
            <div class="d-flex align-items-center gap-3 flex-wrap">
                <label class="mb-0">Overlay opacity: <strong id="opacityVal">70</strong>%</label>
                <input type="range" class="form-range transparency-slider" id="opacitySlider" min="0" max="100" value="70">
                <button type="button" class="btn btn-outline-secondary btn-sm" id="opacityReset">Reset</button>
            </div>
            <p class="small text-muted mt-2 mb-0">Label overlay improves text readability on banners.</p>
        </div>
        <div class="mt-3">
            <h6>Live preview</h6>
            <div class="banner-preview-wrap" id="bannerPreview">
                <img src="{{ form.instance.image.url }}" alt="Banner">
                <div class="overlay" id="previewOverlay" style="background: rgba(11,83,69, 0.7);">
                    <div class="label-preview">
                        <strong>{{ form.instance.title|default:"Banner Title" }}</strong><br>
                        <small>{{ form.instance.subtitle|default:"Subtitle text" }}</small>
                    </div>
                </div>
            </div>
            <p class="small text-muted mt-2">Rendered aspect: 16:9 &bull; Responsive (desktop/tablet/mobile)</p>
        </div>
        {% endif %}

        <div class="mt-4">
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="{% url 'cms_home' %}" class="btn btn-outline-secondary">Cancel</a>
        </div>
    </form>
</div>
<script>
document.addEventListener('DOMContentLoaded', function(){
    var slider = document.getElementById('opacitySlider');
    var valEl = document.getElementById('opacityVal');
    var overlay = document.getElementById('previewOverlay');
    var opacityInput = document.querySelector('input[name="overlay_opacity"]');
    var resetBtn = document.getElementById('opacityReset');
    if (slider && opacityInput) {
        var v = parseFloat(opacityInput.value || 0.7) * 100;
        slider.value = Math.round(v);
        valEl.textContent = Math.round(v);
        if (overlay) overlay.style.background = 'rgba(11,83,69,' + (v/100) + ')';
        slider.addEventListener('input', function(){
            var pct = parseInt(this.value, 10);
            valEl.textContent = pct;
            opacityInput.value = (pct / 100).toFixed(2);
            if (overlay) overlay.style.background = 'rgba(11,83,69,' + (pct/100) + ')';
        });
        resetBtn?.addEventListener('click', function(){
            slider.value = 70;
            valEl.textContent = 70;
            opacityInput.value = '0.70';
            if (overlay) overlay.style.background = 'rgba(11,83,69,0.7)';
        });
    }
});
</script>
{% endblock %}
