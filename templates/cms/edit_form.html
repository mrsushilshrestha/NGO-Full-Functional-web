{% extends 'cms/base.html' %}
{% load crispy_forms_tags %}
{% block title %}{{ title }}{% endblock %}
{% block page_title %}{{ title }}{% endblock %}
{% block content %}
<div class="cms-card">
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form|crispy }}
        {% if form_type == 'announcement' %}
        <div class="mt-3" id="announcementImagePreviewWrap" style="display:none;">
            <label class="form-label">Image preview</label>
            <div class="border rounded p-2 bg-light" style="max-width: 400px;">
                <img id="announcementImagePreview" src="" alt="Preview" class="img-fluid rounded" style="max-height: 200px; object-fit: contain;">
            </div>
        </div>
        {% endif %}
        <div class="mt-3">
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="{% url back_url %}" class="btn btn-outline-secondary">Cancel</a>
        </div>
    </form>
</div>
{% if form_type == 'announcement' %}
<script>
document.addEventListener('DOMContentLoaded', function(){
    var input = document.querySelector('input[name="image"]');
    var wrap = document.getElementById('announcementImagePreviewWrap');
    var img = document.getElementById('announcementImagePreview');
    if (input && wrap && img) {
        var existing = '{% if form.instance.image %}{{ form.instance.image.url }}{% endif %}';
        if (existing) { img.src = existing; wrap.style.display = 'block'; }
        input.addEventListener('change', function(){
            var f = this.files[0];
            if (f) {
                var r = new FileReader();
                r.onload = function(){ img.src = r.result; wrap.style.display = 'block'; };
                r.readAsDataURL(f);
            } else { img.src = ''; wrap.style.display = 'none'; }
        });
    }
});
</script>
{% endif %}
{% endblock %}
